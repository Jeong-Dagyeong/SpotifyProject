"use strict";(self.webpackChunkspotify_demo=self.webpackChunkspotify_demo||[]).push([[245],{2229:(e,t,r)=>{r.d(t,{A:()=>i});var a=r(1083),n=r(5800);const o=a.A.create({baseURL:n.$7,headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("access_token"))}});o.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem("access_token")),e)));const i=o},5245:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Z});var a=r(6739),n=r(6858),o=r(9494),i=r(5647),s=r(5147),l=r(2764),c=r(680),d=r(431),h=r(6773),p=r(3075),u=r(7862),g=r(4872),x=r(7665),y=r(7097),m=r(8511),f=r(7286),j=r(2229);const v=async()=>{try{return(await j.A.get("/me")).data}catch(e){throw new Error("fail to fetch user porfile")}},A=()=>{const e=localStorage.getItem("access_token");return(0,f.I)({queryKey:["current-user-profile"],queryFn:v,enabled:!!e})};var w=r(9783),b=r(5800);const k=async()=>{const e=crypto.getRandomValues(new Uint8Array(64)).reduce(((e,t)=>e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[t%62]),""),t=(r=await(async e=>{const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest("SHA-256",t)})(e),btoa(String.fromCharCode(...new Uint8Array(r))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"));var r;const a=w.U6,n=b._q,o=w.iW,i=new URL("https://accounts.spotify.com/authorize");if(window.localStorage.setItem("code_verifier",e),a&&n){const e={response_type:"code",client_id:a,scope:o,code_challenge_method:"S256",code_challenge:t,redirect_uri:n};return i.search=new URLSearchParams(Object.entries(e)).toString(),window.location.href=i.toString(),i.toString()}throw new Error("Missing client ID or redirect URI")};var C=r(4848);const S=()=>{const e=(0,a.Ay)("div")((e=>{let{theme:t}=e;return{heigth:"100vh"}})),t=(0,a.Ay)("div")((e=>{let{theme:t}=e;return{width:"80%",height:"150px",backgroundColor:t.palette.background.paper,borderRadius:"10px",padding:"20px",margin:"0 auto",marginTop:"10px"}})),r=(0,a.Ay)(d.A)((e=>{let{theme:t}=e;return{width:"120px",height:"30px",borderRadius:"30px",backgroundColor:t.palette.text.primary,color:t.palette.background.default,textAlign:"center",marginTop:"20px"}}));return(0,C.jsx)("div",{children:(0,C.jsx)(e,{children:(0,C.jsxs)(t,{children:[(0,C.jsx)(o.A,{variant:"h2",fontWeight:700,children:"Create your first playlist"}),(0,C.jsx)(o.A,{variant:"body1",children:"It's easy, we'll help you"}),(0,C.jsx)(r,{children:(0,C.jsx)(o.A,{variant:"body1",fontWeight:700,children:"Create playlist"})})]})})})};var _=r(6540);const I=(0,a.Ay)("div")((e=>{let{theme:t}=e;return{display:"flex",justifyContent:"space-evenly",marginTop:"30px"}})),E=()=>{const{mutate:e}=(()=>{const{data:e}=A(),t=(0,x.jE)();return(0,y.n)({mutationFn:t=>e?(0,m.Nt)((null==e?void 0:e.id)||"",t):Promise.reject(new Error("user is not definded")),onSuccess:()=>{t.invalidateQueries({queryKey:["current-user-playlists"]}),console.log("성공")}})})(),t=localStorage.getItem("access_token"),[r,a]=(0,_.useState)(!1),n=()=>{a(!1)};return(0,C.jsxs)("div",{children:[(0,C.jsxs)(I,{children:[(0,C.jsx)(c.A,{}),(0,C.jsx)(o.A,{variant:"h2",fontWeight:700,children:"Your Library"}),(0,C.jsx)(d.A,{onClick:()=>{t?e({name:"나의 플레이리스트"}):a(!0)},children:(0,C.jsx)(g.A,{sx:{color:"green"}})})]}),!t&&(0,C.jsx)(S,{}),(0,C.jsxs)(h.A,{open:r,onClose:n,children:[(0,C.jsx)(p.A,{children:"로그인 후 사용 가능합니다."}),(0,C.jsxs)(u.A,{children:[(0,C.jsx)(d.A,{onClick:n,children:"취소"}),(0,C.jsx)(d.A,{onClick:async()=>{const e=await k();window.location.href=e},autoFocus:!0,children:"로그인"})]})]})]})};var R=r(3878),P=r(4529),U=r(6475);var L=r(5692);const W=(0,a.Ay)("div")((e=>{let{theme:t}=e;return{overflowY:"auto",maxHeight:"calc(100vh - 240px)",height:"100%",padding:"12px","&::-webkit-scrollbar":{display:"none"},msOverflowStyle:"none",scrollbarWidth:"none",[t.breakpoints.down("sm")]:{maxHeight:"calc(100vh - 65px - 119px)"}}})),q=(0,a.Ay)(R.A)((e=>{let{theme:t}=e;return{"&:hover":{backgroundColor:t.palette.action.hover}}})),z=()=>{const[e,t]=(0,_.useState)(Boolean(localStorage.getItem("access_token"))),r=(0,i.Zp)(),{data:a,fetchNextPage:n,hasNextPage:s,isFetchingNextPage:l}=function(e){let{limit:t,offset:r}=e,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,U.q)({queryKey:["current-user-playlists"],queryFn:e=>{let{pageParam:r=0}=e;return(0,m.U4)({limit:t,offset:r})},initialPageParam:0,getNextPageParam:e=>{if(e.next){const t=new URL(e.next).searchParams.get("offset");return t?parseInt(t):void 0}},enabled:a})}({limit:10,offset:0},e),{data:c}=A(),{ref:d,inView:h}=(0,L.Wx)();return(0,_.useEffect)((()=>{e&&c&&a&&h&&s&&!l&&n()}),[h,s,l,e,c,a]),(0,_.useEffect)((()=>{const e=()=>t(Boolean(localStorage.getItem("access_token")));return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),[]),c&&a?(0,C.jsxs)(W,{children:[(0,C.jsx)(P.A,{cols:2,gap:16,variant:"standard",children:a.pages.map(((e,t)=>e.items.map(((e,a)=>{const n=Array.isArray(e.images)&&e.images.length>0?e.images[0].url:"",i=e.id;return i?(0,C.jsxs)(q,{onClick:()=>(e=>{r("/playlist/".concat(e))})(i),children:[(0,C.jsx)("img",{src:n||"/images/noImage.png",alt:e.name,loading:"lazy",style:{borderRadius:8}}),(0,C.jsx)(o.A,{variant:"subtitle1",fontWeight:700,color:"limegreen",mt:1,children:e.name}),(0,C.jsxs)(o.A,{variant:"body2",color:"#aaa",children:["Playlist • ",e.owner.display_name]})]},"".concat(t,"-").concat(e.id)):null}))))}),(0,C.jsx)("div",{ref:d})]}):null};var F=r(8344);const N=()=>(0,C.jsx)(d.A,{variant:"contained",color:"secondary",size:"large",onClick:()=>{k()},children:"Login"}),B=(0,a.Ay)(n.A)((e=>{let{theme:t}=e;return{position:"relative",display:"inline-block"}})),T=(0,a.Ay)(n.A)((e=>{let{theme:t}=e;return{position:"absolute",top:"42px",right:-25,backgroundColor:t.palette.background.paper,boxShadow:t.shadows[2],padding:t.spacing(1),borderRadius:t.shape.borderRadius,zIndex:10}})),D=()=>{var e;const[t,r]=(0,_.useState)(!1),[a,o]=(0,_.useState)(!1),[s,l]=(0,_.useState)(!1),{data:c}=A(),g=null==c||null===(e=c.images)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.url,y=(0,i.Zp)(),m=(0,x.jE)(),f=()=>{l(!1)};return(0,C.jsxs)(n.A,{display:"flex",justifyContent:"flex-end",alignItems:"center",height:"40px",position:"relative",children:[c?(0,C.jsxs)(B,{children:[(0,C.jsx)(F.A,{src:!t&&g?g:"/broken-image.jpg",onError:()=>r(!0),alt:"user-profile",sx:{width:32,height:32,cursor:"pointer"},onClick:()=>{o((e=>!e))}}),a&&(0,C.jsx)(T,{children:(0,C.jsx)(d.A,{variant:"text",color:"inherit",size:"small",onClick:()=>{l(!0)},children:"Logout"})})]}):(0,C.jsx)(N,{}),(0,C.jsxs)(h.A,{open:s,onClose:f,children:[(0,C.jsx)(p.A,{children:"로그아웃 하시겠습니까?"}),(0,C.jsxs)(u.A,{children:[(0,C.jsx)(d.A,{onClick:f,children:"취소"}),(0,C.jsx)(d.A,{onClick:()=>{localStorage.removeItem("access_token"),m.clear(),y("/"),window.location.reload()},autoFocus:!0,children:"확인"})]})]})]})},H=(0,a.Ay)("div")({display:"flex",height:"100vh",padding:"8px"}),K=(0,a.Ay)("div")((e=>{let{theme:t}=e;return{width:"331px",height:"100%",display:"flex",flexDirection:"column",[t.breakpoints.down("sm")]:{display:"none"}}})),O=(0,a.Ay)(n.A)((e=>{let{theme:t}=e;return{borderRadius:"8px",backgroundColor:t.palette.background.paper,color:t.palette.text.primary,width:"100%",padding:"20px",marginBottom:"8px",marginRight:"8px"}})),V=(0,a.Ay)("ul")({listStyle:"none",padding:0,margin:0}),Y=(0,a.Ay)(i.k2)((e=>{let{theme:t}=e;return{textDecoration:"none",display:"flex",alignItems:"center",gap:"20px",color:t.palette.text.secondary,"&.active":{color:t.palette.text.primary},"& svg":{color:t.palette.text.secondary},"&.active svg":{color:t.palette.text.primary}}})),Z=()=>(0,C.jsx)("div",{children:(0,C.jsxs)(H,{children:[(0,C.jsxs)(K,{children:[(0,C.jsx)(O,{children:(0,C.jsxs)(V,{children:[(0,C.jsxs)(Y,{to:"/",children:[(0,C.jsx)(s.A,{}),(0,C.jsx)(o.A,{variant:"h2",fontWeight:700,children:"Home"})]}),(0,C.jsxs)(Y,{to:"/search",children:[(0,C.jsx)(l.A,{}),(0,C.jsx)(o.A,{variant:"h2",fontWeight:700,children:"Search"})]})]})}),(0,C.jsx)(E,{}),(0,C.jsx)(z,{})]}),(0,C.jsxs)(O,{children:[(0,C.jsx)(D,{}),(0,C.jsx)(i.sv,{})]})]})})},8511:(e,t,r)=>{r.d(t,{Dg:()=>i,Nt:()=>s,U4:()=>n,bt:()=>o});var a=r(2229);const n=async e=>{let{limit:t,offset:r}=e;try{return(await a.A.get("/me/playlists",{params:{limit:t,offset:r}})).data}catch(e){throw new Error("fila to fetch current user playlists")}},o=async e=>{try{return(await a.A.get("/playlists/".concat(e.playlist_id),{params:e})).data}catch(e){throw new Error("fail to fetch playlist detail")}},i=async e=>{try{return(await a.A.get("/playlists/".concat(e.playlist_id,"/tracks"),{params:e})).data}catch(e){throw new Error("fail to fetch playlist items")}},s=async(e,t)=>{try{const{name:r,playlist_public:n,collaborative:o,description:i}=t;return(await a.A.post("/users/".concat(e,"/playlists"),{name:r,public:n,collaborative:o,description:i})).data}catch(e){throw new Error("fail to fetch create playlist")}}}}]);
//# sourceMappingURL=245.js.map?ver=25bdbe5450ad1547ca5c